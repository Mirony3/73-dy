<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>NFC Tag ‚Äì Tagesnachricht mit Textbl√∂cken</title>
    <script>
      const docUrl = "https://docs.google.com/document/d/1yeyTZNerEmf2N8mN5pGfU66mfSFUkCbQnFK2k9E7beA/export?format=txt";

      // Heutiges Datum im Format TT.MM.JJJJ
      const now = new Date();
      const day = String(now.getDate()).padStart(2, '0');
      const month = String(now.getMonth() + 1).padStart(2, '0');
      const year = now.getFullYear();
      const todayStr = `${day}.${month}.${year}`;

      // Seedbare Zufallsfunktion basierend auf Tageswert
      function seededRandom(seed) {
        let x = Math.sin(seed) * 10000;
        return x - Math.floor(x);
      }

      fetch(docUrl)
        .then(response => response.text())
        .then(text => {
          const lines = text.split("\n");
          const randoms = [];
          let message = null;

          let currentDate = null;
          let buffer = [];

          for (let i = 0; i < lines.length; i++) {
            const line = lines[i].trim();

            if (line.match(/^\d{2}\.\d{2}\.\d{4}:/)) {
              // Datum-Zeile gefunden
              if (currentDate && buffer.length > 0) {
                if (currentDate === todayStr) {
                  message = buffer.join("\n").trim();
                }
              }
              currentDate = line.split(":")[0];
              buffer = [line.split(":").slice(1).join(":").trim()];
            } else if (line.startsWith("RANDOM:")) {
              randoms.push(line.replace("RANDOM:", "").trim());
            } else if (line !== "") {
              buffer.push(line);
            }
          }

          // Letzten Block pr√ºfen
          if (currentDate === todayStr && buffer.length > 0 && !message) {
            message = buffer.join("\n").trim();
          }

          // Zufall (aber stabil pro Tag)
          if (!message && randoms.length > 0) {
            const seed = new Date(year, now.getMonth(), now.getDate()).getTime() / 86400000;
            const index = Math.floor(seededRandom(seed) * randoms.length);
            message = randoms[index];
          }

          if (!message) {
            message = "üåÄ Heute gibt‚Äôs nichts Neues.";
          }

          if (message.startsWith("http")) {
            window.location.href = message;
          } else {
            alert(message);
          }
        })
        .catch(() => {
          alert("‚ö†Ô∏è Nachricht konnte nicht geladen werden.");
        });
    </script>
  </head>
  <body></body>
</html>
