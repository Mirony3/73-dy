<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>NFC Nachricht (Datum: TT.MM.JJJJ)</title>
    <script>
      const docUrl = "https://docs.google.com/document/d/1yeyTZNerEmf2N8mN5pGfU66mfSFUkCbQnFK2k9E7beA/export?format=txt";

      // Aktuelles Datum im Format TT.MM.JJJJ erzeugen
      const now = new Date();
      const day = String(now.getDate()).padStart(2, '0');
      const month = String(now.getMonth() + 1).padStart(2, '0'); // Monate: 0â€“11
      const year = now.getFullYear();
      const todayStr = `${day}.${month}.${year}`; // z.â€¯B. 04.07.2025

      const fallbackMessages = [
        "ðŸ’¬ Heute ist dein Tag â€“ ganz ohne Plan.",
        "ðŸŽ² Nichts geplant, aber alles mÃ¶glich.",
        "ðŸ§  Du bist besser als du denkst.",
        "ðŸ€ GlÃ¼ck kommt von innen.",
        "ðŸŒˆ Du brauchst keinen Grund zum LÃ¤cheln."
      ];

      fetch(docUrl)
        .then(response => response.text())
        .then(text => {
          const lines = text.split("\n").map(l => l.trim()).filter(l => l.length > 0);

          let todayMessage = null;
          const randoms = [];

          lines.forEach(line => {
            if (line.startsWith(todayStr + ":")) {
              todayMessage = line.split(":").slice(1).join(":").trim(); // erlaubt Doppelpunkte im Text
            } else if (line.startsWith("RANDOM:")) {
              randoms.push(line.replace("RANDOM:", "").trim());
            }
          });

          let message = todayMessage;

          if (!message && randoms.length > 0) {
            message = randoms[Math.floor(Math.random() * randoms.length)];
          }

          if (!message) {
            message = fallbackMessages[Math.floor(Math.random() * fallbackMessages.length)];
          }

          if (message.startsWith("http")) {
            window.location.href = message;
          } else {
            alert(message);
          }
        })
        .catch(() => {
          const fallback = fallbackMessages[Math.floor(Math.random() * fallbackMessages.length)];
          alert(fallback);
        });
    </script>
  </head>
  <body></body>
</html>
