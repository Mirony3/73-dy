<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>T√§gliche Nachricht</title>
    <style>
      body {
        background: #f7f7f7;
        font-family: "Segoe UI", sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        padding: 20px;
        margin: 0;
      }
      .card {
        background: white;
        border-radius: 16px;
        padding: 24px;
        max-width: 500px;
        box-shadow: 0 8px 24px rgba(0,0,0,0.1);
        text-align: left;
      }
      .date {
        font-size: 0.9em;
        color: #888;
        margin-bottom: 12px;
      }
      .message {
        white-space: pre-wrap;
        font-size: 1.1em;
        line-height: 1.5;
      }
    </style>
  </head>
  <body>
    <div class="card">
      <div class="date" id="date"></div>
      <div class="message" id="message">Lade Nachricht...</div>
    </div>

    <script>
      const docUrl = "https://docs.google.com/document/d/1yeyTZNerEmf2N8mN5pGfU66mfSFUkCbQnFK2k9E7beA/export?format=txt";

      const now = new Date();
      const day = String(now.getDate()).padStart(2, '0');
      const month = String(now.getMonth() + 1).padStart(2, '0');
      const year = now.getFullYear();
      const todayStr = `${day}.${month}.${year}`;

      document.getElementById("date").textContent = todayStr;

      function seededRandom(seed) {
        let x = Math.sin(seed) * 10000;
        return x - Math.floor(x);
      }

      fetch(docUrl)
        .then(response => response.text())
        .then(text => {
          const lines = text.split("\n");
          const randoms = [];
          let message = null;
          let currentDate = null;
          let buffer = [];

          for (let i = 0; i < lines.length; i++) {
            const line = lines[i].trim();

            if (line.match(/^\d{2}\.\d{2}\.\d{4}:/)) {
              if (currentDate && buffer.length > 0) {
                if (currentDate === todayStr) {
                  message = buffer.join("\n").trim();
                }
              }
              currentDate = line.split(":")[0];
              buffer = [line.split(":").slice(1).join(":").trim()];
            } else if (line.startsWith("RANDOM:")) {
              randoms.push(line.replace("RANDOM:", "").trim());
            } else if (line !== "") {
              buffer.push(line);
            }
          }

          if (currentDate === todayStr && buffer.length > 0 && !message) {
            message = buffer.join("\n").trim();
          }

          if (!message && randoms.length > 0) {
            const seed = new Date(year, now.getMonth(), now.getDate()).getTime() / 86400000;
            const index = Math.floor(seededRandom(seed) * randoms.length);
            message = randoms[index];
          }

          if (!message) {
            message = "üåÄ Heute gibt‚Äôs nichts Neues.";
          }

          if (message.startsWith("http")) {
            window.location.href = message;
          } else {
            document.getElementById("message").textContent = message;
          }
        })
        .catch(() => {
          document.getElementById("message").textContent = "‚ö†Ô∏è Nachricht konnte nicht geladen werden.";
        });
    </script>
  </body>
</html>
