<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>T√§gliche NFC-Nachricht</title>
    <script>
      const docUrl = "https://docs.google.com/document/d/1yeyTZNerEmf2N8mN5pGfU66mfSFUkCbQnFK2k9E7beA/export?format=txt";

      // Heutiges Datum im Format TT.MM.JJJJ
      const now = new Date();
      const day = String(now.getDate()).padStart(2, '0');
      const month = String(now.getMonth() + 1).padStart(2, '0');
      const year = now.getFullYear();
      const todayStr = `${day}.${month}.${year}`;

      // Seedbare Zufallsfunktion basierend auf Tageswert
      function seededRandom(seed) {
        let x = Math.sin(seed) * 10000;
        return x - Math.floor(x);
      }

      fetch(docUrl)
        .then(response => response.text())
        .then(text => {
          const lines = text.split("\n").map(line => line.trim()).filter(line => line.length > 0);

          let todayMessage = null;
          const randoms = [];

          lines.forEach(line => {
            if (line.startsWith(todayStr + ":")) {
              todayMessage = line.split(":").slice(1).join(":").trim();
            } else if (line.startsWith("RANDOM:")) {
              randoms.push(line.replace("RANDOM:", "").trim());
            }
          });

          let message = todayMessage;

          if (!message && randoms.length > 0) {
            // Stabiler Seed: Zeit um 00:00 Uhr
            const daySeed = new Date(year, now.getMonth(), now.getDate()).getTime() / 86400000; // ein Tag = 86400000ms
            const index = Math.floor(seededRandom(daySeed) * randoms.length);
            message = randoms[index];
          }

          if (!message) {
            message = "üåÄ Heute gibt‚Äôs nichts Neues.";
          }

          if (message.startsWith("http")) {
            window.location.href = message;
          } else {
            alert(message);
          }
        })
        .catch(() => {
          alert("‚ö†Ô∏è Konnte keine Nachricht laden.");
        });
    </script>
  </head>
  <body></body>
</html>
